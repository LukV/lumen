<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Lumen</title>
<link href="https://fonts.googleapis.com/css2?family=Source+Serif+4:ital,opsz,wght@0,8..60,300;0,8..60,400;0,8..60,500;0,8..60,600;1,8..60,400&family=DM+Sans:ital,opsz,wght@0,9..40,300;0,9..40,400;0,9..40,500;0,9..40,600;1,9..40,400&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
  /* ═══════════════════════════════
     THEME TOKENS
     ═══════════════════════════════ */
  [data-theme="light"] {
    --bg: #F6F4F0;
    --bg-warm: #EDEAE4;
    --bg-card: #FAFAF8;
    --bg-card-hover: #F5F3EF;
    --bg-code: #2C2A27;
    --bg-code-surface: #35332F;
    --text-primary: #2C2A27;
    --text-secondary: #7A756D;
    --text-tertiary: #A39E95;
    --text-on-dark: #E8E5DF;
    --accent: #4A2D4F;
    --accent-light: #5E3A64;
    --accent-muted: rgba(74, 45, 79, 0.08);
    --accent-border: rgba(74, 45, 79, 0.15);
    --accent-glow: rgba(74, 45, 79, 0.06);
    --border: rgba(44, 42, 39, 0.08);
    --border-strong: rgba(44, 42, 39, 0.14);
    --success: #4A7A6F;
    --logo-fill: #4A2D4F;
    --code-bg: #2C2A27;
    --code-text: #E8E5DF;
    --code-border: rgba(255,255,255,0.06);
    --code-btn-border: rgba(255,255,255,0.1);
    --code-btn-bg: #35332F;
    --code-btn-hover: rgba(255,255,255,0.08);
    --theme-toggle-bg: var(--bg-warm);
    --scrollbar: rgba(44,42,39,0.12);
  }

  [data-theme="dark"] {
    --bg: #1A1917;
    --bg-warm: #222120;
    --bg-card: #252422;
    --bg-card-hover: #2C2B28;
    --bg-code: #151413;
    --bg-code-surface: #1E1D1B;
    --text-primary: #E8E5DF;
    --text-secondary: #9A9590;
    --text-tertiary: #6B6762;
    --text-on-dark: #E8E5DF;
    --accent: #9B7BA0;
    --accent-light: #B08FB5;
    --accent-muted: rgba(155, 123, 160, 0.1);
    --accent-border: rgba(155, 123, 160, 0.2);
    --accent-glow: rgba(155, 123, 160, 0.06);
    --border: rgba(232, 229, 223, 0.06);
    --border-strong: rgba(232, 229, 223, 0.1);
    --success: #6BAA9E;
    --logo-fill: #B08FB5;
    --code-bg: #151413;
    --code-text: #C5C2BC;
    --code-border: rgba(255,255,255,0.04);
    --code-btn-border: rgba(255,255,255,0.08);
    --code-btn-bg: #1E1D1B;
    --code-btn-hover: rgba(255,255,255,0.06);
    --theme-toggle-bg: #2C2B28;
    --scrollbar: rgba(232,229,223,0.08);
  }

  :root {
    --data-1: #4A2D4F;
    --data-2: #C2876E;
    --data-3: #6B8F8A;
    --font-body: 'DM Sans', system-ui, sans-serif;
    --font-editorial: 'Source Serif 4', Georgia, serif;
    --font-mono: 'JetBrains Mono', monospace;
    --topbar-height: 52px;
    --radius: 6px;
    --radius-sm: 4px;
    --ease-out: cubic-bezier(0.16, 1, 0.3, 1);
    --ease-in-out: cubic-bezier(0.4, 0, 0.2, 1);
  }

  [data-theme="dark"] {
    --data-1: #9B7BA0;
    --data-2: #D4A08A;
    --data-3: #7FABA5;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    background: var(--bg);
    color: var(--text-primary);
    font-family: var(--font-body);
    -webkit-font-smoothing: antialiased;
    height: 100vh; overflow: hidden;
    transition: background 0.35s var(--ease-in-out), color 0.35s var(--ease-in-out);
  }

  .app { display: flex; flex-direction: column; height: 100vh; }

  /* ═══════════════════════════════
     TOPBAR
     ═══════════════════════════════ */
  .topbar {
    height: var(--topbar-height);
    border-bottom: 1px solid var(--border);
    display: flex; align-items: center; justify-content: space-between;
    padding: 0 28px; flex-shrink: 0;
    background: var(--bg-card);
    transition: background 0.35s, border-color 0.35s;
  }
  .topbar-left { display: flex; align-items: center; gap: 10px; }
  .topbar-wordmark {
    font-family: var(--font-editorial);
    font-size: 19px; font-weight: 300; letter-spacing: 0.03em;
    color: var(--text-primary); transition: color 0.35s;
  }
  .topbar-right { display: flex; align-items: center; gap: 16px; }
  .conn-indicator {
    display: flex; align-items: center; gap: 8px;
    font-size: 12px; color: var(--text-secondary); transition: color 0.35s;
  }
  .conn-dot { width: 6px; height: 6px; border-radius: 50%; background: var(--success); transition: background 0.35s; }

  .topbar-icon-btn {
    width: 30px; height: 30px; border: none; background: transparent;
    border-radius: var(--radius-sm); cursor: pointer;
    display: flex; align-items: center; justify-content: center;
    color: var(--text-tertiary); transition: all 0.15s;
  }
  .topbar-icon-btn:hover { background: var(--bg-warm); color: var(--text-primary); }

  /* Theme toggle */
  .theme-toggle {
    width: 30px; height: 30px; border: none;
    background: var(--theme-toggle-bg);
    border-radius: var(--radius-sm); cursor: pointer;
    display: flex; align-items: center; justify-content: center;
    color: var(--text-secondary); transition: all 0.2s;
  }
  .theme-toggle:hover { color: var(--text-primary); }
  .theme-toggle .icon-sun,
  .theme-toggle .icon-moon { display: none; }
  [data-theme="light"] .theme-toggle .icon-moon { display: block; }
  [data-theme="dark"] .theme-toggle .icon-sun { display: block; }

  /* ═══════════════════════════════
     EMPTY STATE
     ═══════════════════════════════ */
  .view-empty {
    flex: 1; display: flex; flex-direction: column;
    align-items: center; justify-content: center;
    padding: 0 32px 60px;
  }
  .view-empty.hidden { display: none; }

  .hero-title {
    font-family: var(--font-editorial);
    font-size: 34px; font-weight: 300; line-height: 1.3;
    color: var(--text-primary); margin-bottom: 12px;
    letter-spacing: -0.01em; text-align: center;
    transition: color 0.35s;
  }
  .hero-sub {
    font-size: 15px; color: var(--text-secondary);
    line-height: 1.6; text-align: center; margin-bottom: 40px;
    transition: color 0.35s;
  }
  .hero-input-wrapper {
    width: 100%; max-width: 640px;
    display: flex; align-items: center;
    background: var(--bg-card);
    border: 1px solid var(--border-strong);
    border-radius: var(--radius);
    padding: 4px 4px 4px 20px;
    transition: border-color 0.2s, box-shadow 0.2s, background 0.35s;
  }
  .hero-input-wrapper:focus-within {
    border-color: var(--accent-border);
    box-shadow: 0 0 0 3px var(--accent-glow);
  }
  .hero-input {
    flex: 1; border: none; outline: none; background: transparent;
    font-family: var(--font-body); font-size: 15px;
    color: var(--text-primary); padding: 14px 0;
  }
  .hero-input::placeholder { color: var(--text-tertiary); }

  .btn-ask {
    padding: 11px 28px; background: var(--accent); color: var(--bg);
    border: none; border-radius: var(--radius-sm);
    font-family: var(--font-body); font-size: 14px; font-weight: 500;
    cursor: pointer; transition: all 0.15s; flex-shrink: 0;
  }
  .btn-ask:hover { background: var(--accent-light); }

  .sample-prompts {
    display: flex; justify-content: center; gap: 10px;
    margin-top: 24px; flex-wrap: wrap;
  }
  .sample-chip {
    font-size: 13px; color: var(--text-secondary);
    padding: 8px 16px; background: var(--bg-card);
    border: 1px solid var(--border); border-radius: 20px;
    cursor: pointer; transition: all 0.2s; white-space: nowrap;
  }
  .sample-chip:hover {
    border-color: var(--accent-border); color: var(--accent);
    background: var(--accent-muted);
  }

  .get-started-link {
    margin-top: 24px; font-size: 13px; color: var(--accent);
    cursor: pointer; display: flex; align-items: center; gap: 5px;
    transition: color 0.15s; text-decoration: none;
    font-weight: 500; letter-spacing: 0.01em;
  }
  .get-started-link:hover { color: var(--accent-light); }

  /* ═══════════════════════════════
     RESULTS STATE
     ═══════════════════════════════ */
  .view-results {
    flex: 1; display: none; flex-direction: column; min-height: 0;
  }
  .view-results.visible { display: flex; }

  .results-scroll { flex: 1; overflow-y: auto; scroll-behavior: smooth; }
  .results-inner { max-width: 820px; margin: 0 auto; padding: 8px 32px 40px; }

  /* Bottom input */
  .bottom-input-bar {
    flex-shrink: 0; border-top: 1px solid var(--border);
    background: var(--bg-card); padding: 14px 32px;
    transition: background 0.35s, border-color 0.35s;
  }
  .bottom-input-inner { max-width: 820px; margin: 0 auto; }
  .bottom-input-wrapper {
    display: flex; align-items: center;
    background: var(--bg); border: 1px solid var(--border-strong);
    border-radius: var(--radius); padding: 3px 3px 3px 20px;
    transition: border-color 0.2s, box-shadow 0.2s, background 0.35s;
  }
  .bottom-input-wrapper:focus-within {
    border-color: var(--accent-border);
    box-shadow: 0 0 0 3px var(--accent-glow);
  }
  .bottom-input {
    flex: 1; border: none; outline: none; background: transparent;
    font-family: var(--font-body); font-size: 14px;
    color: var(--text-primary); padding: 10px 0;
  }
  .bottom-input::placeholder { color: var(--text-tertiary); }
  .btn-ask-sm {
    padding: 9px 22px; background: var(--accent); color: var(--bg);
    border: none; border-radius: var(--radius-sm);
    font-family: var(--font-body); font-size: 13px; font-weight: 500;
    cursor: pointer; transition: all 0.15s; flex-shrink: 0;
  }
  .btn-ask-sm:hover { background: var(--accent-light); }

  /* ═══════════════════════════════
     ANALYSIS CELL — unified card
     ═══════════════════════════════ */
  .cell {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    margin-top: 24px;
    overflow: hidden;
    transition: background 0.35s, border-color 0.35s;
  }

  .cell-body {
    padding: 28px 32px;
  }

  /* Title */
  .cell-title {
    font-family: var(--font-editorial);
    font-size: 19px; font-weight: 600;
    color: var(--text-primary);
    margin-bottom: 24px;
    line-height: 1.35;
    transition: color 0.35s;
  }

  /* Chart area */
  .cell-chart {
    margin-bottom: 24px;
  }

  .bar-row { display: flex; align-items: center; gap: 12px; margin-bottom: 7px; }
  .bar-label {
    font-size: 12px; color: var(--text-secondary);
    width: 120px; text-align: right; flex-shrink: 0;
    white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
    transition: color 0.35s;
  }
  .bar-track {
    flex: 1; height: 20px; background: var(--bg-warm);
    border-radius: 2px; overflow: hidden; transition: background 0.35s;
  }
  .bar-fill { height: 100%; border-radius: 2px; transition: width 0.6s var(--ease-out), background 0.35s; }
  .bar-value {
    font-size: 11px; color: var(--text-tertiary);
    width: 56px; flex-shrink: 0; font-family: var(--font-mono);
    transition: color 0.35s;
  }

  /* Line chart (SVG) */
  .line-chart-svg { width: 100%; height: auto; }
  .line-chart-svg text { transition: fill 0.35s; }
  .line-chart-svg line, .line-chart-svg polyline, .line-chart-svg circle { transition: stroke 0.35s, fill 0.35s; }

  /* Narrative / insight */
  .cell-insight {
    padding-top: 20px;
    border-top: 1px solid var(--border);
    transition: border-color 0.35s;
  }
  .cell-insight p {
    font-family: var(--font-editorial);
    font-size: 14.5px; line-height: 1.75;
    color: var(--text-secondary); font-weight: 400;
    transition: color 0.35s;
  }
  .cell-insight .hl {
    background: var(--accent-muted); padding: 1px 5px;
    border-radius: 3px; color: var(--accent); font-weight: 500;
    white-space: nowrap; transition: all 0.35s;
  }

  /* Footer strip */
  .cell-footer {
    display: flex; align-items: center; justify-content: space-between;
    padding: 12px 32px;
    border-top: 1px solid var(--border);
    background: var(--bg-warm);
    transition: background 0.35s, border-color 0.35s;
  }
  .cell-footer-left {
    display: flex; align-items: center; gap: 16px;
  }
  .cell-link {
    font-size: 12px; color: var(--text-tertiary);
    background: none; border: none; cursor: pointer;
    font-family: var(--font-body);
    display: flex; align-items: center; gap: 5px;
    transition: color 0.15s;
    padding: 0;
  }
  .cell-link:hover { color: var(--accent); }
  .cell-link .arrow {
    display: inline-block; font-size: 10px;
    transition: transform 0.25s var(--ease-out);
  }
  .cell-link .arrow.open { transform: rotate(90deg); }

  .cell-meta-strip {
    font-size: 11px; color: var(--text-tertiary);
    display: flex; gap: 10px; align-items: center;
    transition: color 0.35s;
  }
  .cell-meta-strip .sep {
    width: 3px; height: 3px; border-radius: 50%;
    background: var(--border-strong); transition: background 0.35s;
  }

  /* Code drawer */
  .code-drawer {
    overflow: hidden; max-height: 0;
    transition: max-height 0.4s var(--ease-out);
  }
  .code-drawer.open { max-height: 600px; }

  .code-block {
    background: var(--code-bg); overflow: hidden;
    transition: background 0.35s;
  }
  .code-tabs {
    display: flex; gap: 0;
    border-bottom: 1px solid var(--code-border);
    padding: 0 32px;
  }
  .code-tab {
    padding: 10px 16px; font-size: 12px; font-weight: 500;
    color: rgba(232,229,223,0.35); background: transparent;
    border: none; cursor: pointer; font-family: var(--font-body);
    border-bottom: 2px solid transparent; transition: all 0.15s;
  }
  .code-tab.active { color: var(--code-text); border-bottom-color: var(--accent); }
  .code-tab:hover:not(.active) { color: rgba(232,229,223,0.55); }

  .code-content {
    padding: 20px 32px; font-family: var(--font-mono);
    font-size: 12.5px; line-height: 1.7; color: var(--code-text);
    overflow-x: auto; white-space: pre; transition: color 0.35s;
  }
  .code-content .kw { color: #C2876E; }
  .code-content .fn { color: #7FABA5; }
  .code-content .str { color: #B8A44C; }

  .code-actions {
    padding: 8px 32px 14px; display: flex; gap: 8px;
  }
  .btn-code-action {
    padding: 6px 14px; border-radius: var(--radius-sm);
    border: 1px solid var(--code-btn-border);
    background: var(--code-btn-bg); color: var(--code-text);
    font-family: var(--font-body); font-size: 11px; font-weight: 500;
    cursor: pointer; transition: all 0.15s;
  }
  .btn-code-action:hover { background: var(--code-btn-hover); }
  .btn-code-action.primary { background: var(--accent); border-color: var(--accent); color: var(--bg); }
  .btn-code-action.primary:hover { background: var(--accent-light); }

  /* Processing */
  .cell-processing {
    padding: 32px; display: flex; align-items: center; gap: 12px;
  }
  .processing-dots { display: flex; gap: 4px; }
  .processing-dots span {
    width: 5px; height: 5px; border-radius: 50%;
    background: var(--accent); opacity: 0.3;
    animation: dot-pulse 1.2s ease-in-out infinite;
  }
  .processing-dots span:nth-child(2) { animation-delay: 0.15s; }
  .processing-dots span:nth-child(3) { animation-delay: 0.3s; }
  @keyframes dot-pulse { 0%,100%{opacity:.2} 50%{opacity:.7} }
  .processing-stage { font-size: 12px; color: var(--text-tertiary); }

  /* Scrollbar */
  .results-scroll::-webkit-scrollbar { width: 6px; }
  .results-scroll::-webkit-scrollbar-track { background: transparent; }
  .results-scroll::-webkit-scrollbar-thumb { background: var(--scrollbar); border-radius: 3px; }
</style>
</head>
<body>

<div class="app">
  <!-- Topbar -->
  <header class="topbar">
    <div class="topbar-left">
      <svg width="26" height="26" viewBox="0 0 40 40" fill="none">
        <rect x="4" y="8" width="3" height="24" rx="1.5" fill="var(--logo-fill)"/>
        <rect x="12" y="14" width="3" height="18" rx="1.5" fill="var(--logo-fill)" opacity="0.7"/>
        <rect x="20" y="6" width="3" height="26" rx="1.5" fill="var(--logo-fill)" opacity="0.85"/>
        <rect x="28" y="11" width="3" height="21" rx="1.5" fill="var(--logo-fill)" opacity="0.55"/>
        <rect x="36" y="18" width="3" height="14" rx="1.5" fill="var(--logo-fill)" opacity="0.35"/>
        <line x1="2" y1="33.5" x2="40" y2="33.5" stroke="var(--logo-fill)" stroke-width="1" opacity="0.3"/>
      </svg>
      <span class="topbar-wordmark">Lumen</span>
    </div>
    <div class="topbar-right">
      <div class="conn-indicator"><span class="conn-dot"></span>sales_db</div>
      <button class="topbar-icon-btn" title="History">
        <svg width="15" height="15" viewBox="0 0 16 16" fill="none"><path d="M8 3v5l3 2" stroke="currentColor" stroke-width="1.4" stroke-linecap="round"/><circle cx="8" cy="8" r="5.5" stroke="currentColor" stroke-width="1.4"/></svg>
      </button>
      <button class="theme-toggle" onclick="toggleTheme()" title="Toggle theme">
        <svg class="icon-moon" width="15" height="15" viewBox="0 0 16 16" fill="none"><path d="M13.5 9.2A5.5 5.5 0 016.8 2.5 6 6 0 1013.5 9.2z" stroke="currentColor" stroke-width="1.3" stroke-linecap="round" stroke-linejoin="round"/></svg>
        <svg class="icon-sun" width="15" height="15" viewBox="0 0 16 16" fill="none"><circle cx="8" cy="8" r="3" stroke="currentColor" stroke-width="1.3"/><path d="M8 1.5v1.5M8 13v1.5M1.5 8H3M13 8h1.5M3.4 3.4l1 1M11.6 11.6l1 1M3.4 12.6l1-1M11.6 4.4l1-1" stroke="currentColor" stroke-width="1.2" stroke-linecap="round"/></svg>
      </button>
    </div>
  </header>

  <!-- ═══ EMPTY STATE ═══ -->
  <div class="view-empty" id="viewEmpty">
    <h1 class="hero-title">From question to insight<br>in one conversation.</h1>
    <p class="hero-sub">Your thinking partner for reproducible data exploration.</p>
    <div class="hero-input-wrapper">
      <input type="text" class="hero-input" id="heroInput" placeholder="Ask any question about your data…" />
      <button class="btn-ask" onclick="submitQuery()">Ask</button>
    </div>
    <div class="sample-prompts">
      <span class="sample-chip" onclick="fillAndSubmit(this)">Top customers by lifetime value</span>
      <span class="sample-chip" onclick="fillAndSubmit(this)">Revenue trend by quarter</span>
      <span class="sample-chip" onclick="fillAndSubmit(this)">Which categories have declining rentals?</span>
    </div>
    <a class="get-started-link" href="#">Lumen 101: Get Started ›</a>
  </div>

  <!-- ═══ RESULTS STATE ═══ -->
  <div class="view-results" id="viewResults">
    <div class="results-scroll" id="resultsScroll">
      <div class="results-inner">

        <!-- ──── CELL 1 ──── -->
        <div class="cell">
          <div class="cell-body">
            <div class="cell-title">Top 10 customers by lifetime value</div>

            <div class="cell-chart">
              <div class="bar-row"><span class="bar-label">Karl Seal</span><div class="bar-track"><div class="bar-fill" style="width:100%;background:var(--data-1)"></div></div><span class="bar-value">$221.55</span></div>
              <div class="bar-row"><span class="bar-label">Eleanor Hunt</span><div class="bar-track"><div class="bar-fill" style="width:97%;background:var(--data-1);opacity:.85"></div></div><span class="bar-value">$216.54</span></div>
              <div class="bar-row"><span class="bar-label">Clara Shaw</span><div class="bar-track"><div class="bar-fill" style="width:89%;background:var(--data-1);opacity:.72"></div></div><span class="bar-value">$195.58</span></div>
              <div class="bar-row"><span class="bar-label">Marion Snyder</span><div class="bar-track"><div class="bar-fill" style="width:87%;background:var(--data-1);opacity:.65"></div></div><span class="bar-value">$194.61</span></div>
              <div class="bar-row"><span class="bar-label">Rhonda Kennedy</span><div class="bar-track"><div class="bar-fill" style="width:85%;background:var(--data-1);opacity:.58"></div></div><span class="bar-value">$191.62</span></div>
              <div class="bar-row"><span class="bar-label">Tommy Collazo</span><div class="bar-track"><div class="bar-fill" style="width:83%;background:var(--data-1);opacity:.52"></div></div><span class="bar-value">$186.76</span></div>
              <div class="bar-row"><span class="bar-label">Wesley Bull</span><div class="bar-track"><div class="bar-fill" style="width:81%;background:var(--data-1);opacity:.46"></div></div><span class="bar-value">$184.22</span></div>
              <div class="bar-row"><span class="bar-label">Tim Cary</span><div class="bar-track"><div class="bar-fill" style="width:80%;background:var(--data-1);opacity:.42"></div></div><span class="bar-value">$182.91</span></div>
              <div class="bar-row"><span class="bar-label">Marcia Dean</span><div class="bar-track"><div class="bar-fill" style="width:79%;background:var(--data-1);opacity:.38"></div></div><span class="bar-value">$180.34</span></div>
              <div class="bar-row"><span class="bar-label">Ana Bradley</span><div class="bar-track"><div class="bar-fill" style="width:77%;background:var(--data-1);opacity:.34"></div></div><span class="bar-value">$174.66</span></div>
            </div>

            <div class="cell-insight">
              <p>Karl Seal leads as the highest-value customer with <span class="hl">$221.55</span> in lifetime value across <span class="hl">45 transactions</span>, followed closely by Eleanor Hunt at <span class="hl">$216.54</span> with <span class="hl">46 transactions</span>. The top 10 show remarkably consistent spending, with lifetime values ranging from <span class="hl">$174.66</span> to <span class="hl">$221.55</span> and transaction counts between 34–46 purchases. Ana Bradley demonstrates the highest average transaction value at <span class="hl">$5.14</span> per purchase, while Marcia Dean has the lowest at <span class="hl">$4.18</span>.</p>
            </div>
          </div>

          <div class="cell-footer">
            <div class="cell-footer-left">
              <button class="cell-link" onclick="toggleCode(this)" data-target="code1">
                <span class="arrow">▸</span> Show code
              </button>
              <button class="cell-link">Copy insight</button>
              <button class="cell-link">Export chart</button>
            </div>
            <div class="cell-meta-strip">
              <span>10 rows</span><span class="sep"></span>
              <span>160ms</span><span class="sep"></span>
              <span>claude-sonnet-4-20250514</span>
            </div>
          </div>

          <div class="code-drawer" id="code1">
            <div class="code-block">
              <div class="code-tabs">
                <button class="code-tab active">SQL</button>
                <button class="code-tab">Chart Spec</button>
                <button class="code-tab">Reasoning</button>
              </div>
              <div class="code-content"><span class="kw">WITH</span> all_payments <span class="kw">AS</span> (
  <span class="kw">SELECT</span> payment_id, customer_id, staff_id,
         rental_id, amount, payment_date
  <span class="kw">FROM</span> payment_p2022_01
  <span class="kw">UNION ALL</span>
  <span class="kw">SELECT</span> payment_id, customer_id, staff_id,
         rental_id, amount, payment_date
  <span class="kw">FROM</span> payment_p2022_02
)
<span class="kw">SELECT</span>
  c.first_name || <span class="str">' '</span> || c.last_name <span class="kw">AS</span> customer,
  <span class="fn">SUM</span>(p.amount) <span class="kw">AS</span> lifetime_value,
  <span class="fn">COUNT</span>(*) <span class="kw">AS</span> transaction_count
<span class="kw">FROM</span> all_payments p
<span class="kw">JOIN</span> customer c <span class="kw">ON</span> c.customer_id = p.customer_id
<span class="kw">GROUP BY</span> c.customer_id, customer
<span class="kw">ORDER BY</span> lifetime_value <span class="kw">DESC</span>
<span class="kw">LIMIT</span> <span class="str">10</span>;</div>
              <div class="code-actions">
                <button class="btn-code-action primary">Run</button>
                <button class="btn-code-action">Copy</button>
                <button class="btn-code-action">Edit</button>
              </div>
            </div>
          </div>
        </div>

        <!-- ──── CELL 2 ──── -->
        <div class="cell">
          <div class="cell-body">
            <div class="cell-title">Customer acquisition cost by channel</div>

            <div class="cell-chart">
              <svg class="line-chart-svg" viewBox="0 0 700 200" fill="none">
                <!-- Grid -->
                <line x1="60" y1="20" x2="660" y2="20" stroke="var(--border)" stroke-width="0.7"/>
                <line x1="60" y1="60" x2="660" y2="60" stroke="var(--border)" stroke-width="0.7"/>
                <line x1="60" y1="100" x2="660" y2="100" stroke="var(--border)" stroke-width="0.7"/>
                <line x1="60" y1="140" x2="660" y2="140" stroke="var(--border)" stroke-width="0.7"/>
                <!-- Y labels -->
                <text x="52" y="24" text-anchor="end" font-family="var(--font-body)" font-size="10" fill="var(--text-tertiary)">160</text>
                <text x="52" y="64" text-anchor="end" font-family="var(--font-body)" font-size="10" fill="var(--text-tertiary)">130</text>
                <text x="52" y="104" text-anchor="end" font-family="var(--font-body)" font-size="10" fill="var(--text-tertiary)">100</text>
                <text x="52" y="144" text-anchor="end" font-family="var(--font-body)" font-size="10" fill="var(--text-tertiary)">70</text>
                <!-- X labels -->
                <text x="160" y="172" text-anchor="middle" font-family="var(--font-body)" font-size="10" fill="var(--text-tertiary)">Q1 '24</text>
                <text x="310" y="172" text-anchor="middle" font-family="var(--font-body)" font-size="10" fill="var(--text-tertiary)">Q2 '24</text>
                <text x="460" y="172" text-anchor="middle" font-family="var(--font-body)" font-size="10" fill="var(--text-tertiary)">Q3 '24</text>
                <text x="610" y="172" text-anchor="middle" font-family="var(--font-body)" font-size="10" fill="var(--text-tertiary)">Q4 '24</text>
                <!-- Paid search -->
                <polyline points="160,100 310,82 460,48 610,28" fill="none" stroke="var(--data-1)" stroke-width="2"/>
                <circle cx="160" cy="100" r="3.5" fill="var(--data-1)"/>
                <circle cx="310" cy="82" r="3.5" fill="var(--data-1)"/>
                <circle cx="460" cy="48" r="3.5" fill="var(--data-1)"/>
                <circle cx="610" cy="28" r="3.5" fill="var(--data-1)"/>
                <!-- Organic -->
                <polyline points="160,100 310,106 460,96 610,88" fill="none" stroke="var(--data-3)" stroke-width="2"/>
                <circle cx="160" cy="100" r="3.5" fill="var(--data-3)"/>
                <circle cx="310" cy="106" r="3.5" fill="var(--data-3)"/>
                <circle cx="460" cy="96" r="3.5" fill="var(--data-3)"/>
                <circle cx="610" cy="88" r="3.5" fill="var(--data-3)"/>
                <!-- Referral -->
                <polyline points="160,100 310,110 460,124 610,132" fill="none" stroke="var(--data-2)" stroke-width="2"/>
                <circle cx="160" cy="100" r="3.5" fill="var(--data-2)"/>
                <circle cx="310" cy="110" r="3.5" fill="var(--data-2)"/>
                <circle cx="460" cy="124" r="3.5" fill="var(--data-2)"/>
                <circle cx="610" cy="132" r="3.5" fill="var(--data-2)"/>
                <!-- Legend -->
                <line x1="100" y1="192" x2="116" y2="192" stroke="var(--data-1)" stroke-width="2"/>
                <text x="122" y="195" font-family="var(--font-body)" font-size="10" fill="var(--text-tertiary)">Paid search</text>
                <line x1="250" y1="192" x2="266" y2="192" stroke="var(--data-3)" stroke-width="2"/>
                <text x="272" y="195" font-family="var(--font-body)" font-size="10" fill="var(--text-tertiary)">Organic</text>
                <line x1="370" y1="192" x2="386" y2="192" stroke="var(--data-2)" stroke-width="2"/>
                <text x="392" y="195" font-family="var(--font-body)" font-size="10" fill="var(--text-tertiary)">Referral</text>
              </svg>
            </div>

            <div class="cell-insight">
              <p>Paid search acquisition costs have increased <span class="hl">58% since Q1</span>, significantly outpacing organic and referral channels. This divergence accelerated in Q3, coinciding with the competitor's market entry. Referral costs have actually <span class="hl">decreased 18%</span>, suggesting word-of-mouth remains the most efficient channel at current scale.</p>
            </div>
          </div>

          <div class="cell-footer">
            <div class="cell-footer-left">
              <button class="cell-link" onclick="toggleCode(this)" data-target="code2">
                <span class="arrow">▸</span> Show code
              </button>
              <button class="cell-link">Copy insight</button>
              <button class="cell-link">Export chart</button>
            </div>
            <div class="cell-meta-strip">
              <span>4 rows</span><span class="sep"></span>
              <span>92ms</span><span class="sep"></span>
              <span>claude-sonnet-4-20250514</span>
            </div>
          </div>

          <div class="code-drawer" id="code2">
            <div class="code-block">
              <div class="code-tabs">
                <button class="code-tab active">SQL</button>
                <button class="code-tab">Chart Spec</button>
                <button class="code-tab">Reasoning</button>
              </div>
              <div class="code-content"><span class="kw">SELECT</span>
  date_trunc(<span class="str">'quarter'</span>, acquired_at) <span class="kw">AS</span> quarter,
  channel,
  <span class="fn">AVG</span>(acquisition_cost) <span class="kw">AS</span> avg_cac,
  <span class="fn">ROUND</span>(
    <span class="fn">AVG</span>(acquisition_cost) /
    <span class="fn">FIRST_VALUE</span>(<span class="fn">AVG</span>(acquisition_cost))
      <span class="kw">OVER</span> (<span class="kw">PARTITION BY</span> channel <span class="kw">ORDER BY</span> quarter)
    * <span class="str">100</span>, <span class="str">1</span>
  ) <span class="kw">AS</span> indexed
<span class="kw">FROM</span> customer_acquisitions
<span class="kw">WHERE</span> acquired_at >= <span class="str">'2024-01-01'</span>
<span class="kw">GROUP BY</span> quarter, channel
<span class="kw">ORDER BY</span> quarter, channel;</div>
              <div class="code-actions">
                <button class="btn-code-action primary">Run</button>
                <button class="btn-code-action">Copy</button>
                <button class="btn-code-action">Edit</button>
              </div>
            </div>
          </div>
        </div>

      </div>
    </div>

    <!-- Bottom input -->
    <div class="bottom-input-bar">
      <div class="bottom-input-inner">
        <div class="bottom-input-wrapper">
          <input type="text" class="bottom-input" id="bottomInput" placeholder="Ask a follow-up question…" />
          <button class="btn-ask-sm" onclick="submitFollowUp()">Ask</button>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  // State transitions
  function submitQuery() {
    const q = document.getElementById('heroInput').value.trim();
    if (!q) return;
    document.getElementById('viewEmpty').classList.add('hidden');
    document.getElementById('viewResults').classList.add('visible');
    document.getElementById('resultsScroll').scrollTop = 0;
  }

  function fillAndSubmit(chip) {
    document.getElementById('heroInput').value = chip.textContent;
    submitQuery();
  }

  document.getElementById('heroInput').addEventListener('keydown', e => {
    if (e.key === 'Enter') submitQuery();
  });

  function submitFollowUp() {
    const q = document.getElementById('bottomInput').value.trim();
    if (!q) return;
    // Create a processing cell
    const cell = document.createElement('div');
    cell.className = 'cell';
    cell.innerHTML = `<div class="cell-body"><div class="cell-title">${q}</div><div class="cell-processing"><div class="processing-dots"><span></span><span></span><span></span></div><span class="processing-stage">Generating SQL · Analyzing schema…</span></div></div>`;
    document.querySelector('.results-inner').appendChild(cell);
    document.getElementById('bottomInput').value = '';
    setTimeout(() => {
      document.getElementById('resultsScroll').scrollTop =
        document.getElementById('resultsScroll').scrollHeight;
    }, 50);
  }

  document.getElementById('bottomInput').addEventListener('keydown', e => {
    if (e.key === 'Enter') submitFollowUp();
  });

  // Code drawers
  function toggleCode(btn) {
    const id = btn.getAttribute('data-target');
    const drawer = document.getElementById(id);
    const arrow = btn.querySelector('.arrow');
    drawer.classList.toggle('open');
    arrow.classList.toggle('open');
    btn.childNodes[btn.childNodes.length - 1].textContent =
      drawer.classList.contains('open') ? ' Hide code' : ' Show code';
  }

  // Theme
  function toggleTheme() {
    const html = document.documentElement;
    const next = html.getAttribute('data-theme') === 'light' ? 'dark' : 'light';
    html.setAttribute('data-theme', next);
  }
</script>
</body>
</html>